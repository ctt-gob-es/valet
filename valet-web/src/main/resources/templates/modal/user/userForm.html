<form name="altEditor-form" role="form" id="userForm"
	th:object="${userform}" th:action="@{/saveuser}" method="post">
	<input type='hidden' class='primarykey' id="idUserValet"
		th:field="*{idUserValet}">
	<div class="form-group">
		<label for=nif th:text="#{form.user.nif}"></label>
		<script th:inline="javascript" type="text/javascript">
			/*<![CDATA[*/
			var messageNif = /*[[#{form.user.nif.pattern}]]*/'default';
			/*]]>*/
		</script>
		<span id="nif_span" class="badge bgc-red-50 c-red-700 p-10 lh-0 badge-pill"></span>
		<input onblur="validateNif();" type="text" id="nif"
			th:field="*{nif}" class="form-control" required pattern=".{3,15}"></input>
	</div>
	<div class="form-group">
		<label for="name" th:text="#{form.user.name}"></label>
		<script th:inline="javascript" type="text/javascript">
			/*<![CDATA[*/
			var messageName = /*[[#{form.user.name.pattern}]]*/'default';
			/*]]>*/
		</script>
		<span id="name_span" class="badge bgc-red-50 c-red-700 p-10 lh-0 badge-pill"></span>
		<input onblur="validateField(this,messageName);" type="text" id="name"
			th:field="*{name}" class="form-control" required pattern=".{3,15}"></input>
	</div>
	<div class="form-group">
		<label for="surnames" th:text="#{form.user.surnames}"></label>
		<script th:inline="javascript" type="text/javascript">
			/*<![CDATA[*/
			var messageSurname = /*[[#{form.user.surnames.pattern}]]*/'default';
			/*]]>*/
		</script>
		<span id="surnames_span" class="badge bgc-red-50 c-red-700 p-10 lh-0 badge-pill"></span>
		<input onblur="validateField(this,messageSurname);" type="text"
			id="surnames" th:field="*{surnames}"
			class="form-control" required pattern=".{3,30}" />
	</div>
	<div class="form-group">
		<label for="login" th:text="#{form.user.login}"></label>
		<script th:inline="javascript" type="text/javascript">
			/*<![CDATA[*/
			var messageLogin = /*[[#{form.user.login.pattern}]]*/'default';
			/*]]>*/
		</script>
		<span id="login_span"
			class="badge bgc-red-50 c-red-700 p-10 lh-0 badge-pill"></span>
		<input onblur="validateField(this,messageLogin);" type="text"
			id="login" th:field="*{login}" style="overflow: hidden"
			class="form-control" required pattern=".{5,30}" />
	</div>
	<div class="form-group">
		<label for="password" class="col-form-label"
			th:text="#{form.user.password}"></label>
		<script th:inline="javascript" type="text/javascript">
			/*<![CDATA[*/
			var messagePassword = /*[[#{form.user.password.pattern}]]*/'default';
			/*]]>*/
		</script>
		<span id="passwordAdd_span"
			class="badge bgc-red-50 c-red-700 p-10 lh-0 badge-pill"></span>
		<input onblur="validateField(this,messagePassword);" name="password"
			type="password" id="passwordAdd" th:field="*{password}"
			class="form-control" pattern=".{7,30}" required />
	</div>
	<div class="form-group">

		<label for="confirmPassword" class="col-form-label"
			th:text="#{form.user.confirmPassword}"></label> <span
			id="confirmPasswordAdd_span"
			class="badge bgc-red-50 c-red-700 p-10 lh-0 badge-pill"></span>
		<input onblur="validateConfirmPassword();" type="password"
			name="confirmPassword" id="confirmPasswordAdd"
			th:field="*{confirmPassword}" class="form-control" pattern=".{7,30}"
			required />
	</div>
	<div class="form-group">
		<label for="email" th:text="#{form.user.email}"></label>
		<script th:inline="javascript" type="text/javascript">
			/*<![CDATA[*/
			var messageEmail = /*[[#{form.user.email.pattern}]]*/'default';
			/*]]>*/
		</script>
		<span id="email_span"
			class="badge bgc-red-50 c-red-700 p-10 lh-0 badge-pill"></span>
		<input onblur="validateField(messageEmail);" type="email"
			id="email" th:field="*{email}" style="overflow: hidden"
			class="form-control" required />
	</div>

</form>

<script th:inline="javascript" type="text/javascript">
	function validateConfirmPassword() {

		var pass = $('#passwordAdd').val();
		var repass = $('#confirmPasswordAdd').val();
		var messageConfirmPassword = /*[[#{form.user.confirmPassword.pattern}]]*/'default';

		if (($('#passwordAdd').val().length == 0)
				|| ($('#confirmPasswordAdd').val().length == 0)) {
			$("#confirmPasswordAdd_span").text(messageConfirmPassword);
			$("#confirmPasswordAdd_span").addClass(
					"badge bgc-red-50 c-red-700 p-10 lh-0 badge-pill");
		} else if (pass != repass) {
			$("#confirmPasswordAdd_span").text(messageConfirmPassword);
			$("#confirmPasswordAdd_span").addClass(
					"badge bgc-red-50 c-red-700 p-10 lh-0 badge-pill");
		} else {
			$("#confirmPasswordAdd_span").text('');
			$("#confirmPasswordAdd_span").removeClass(
					"badge bgc-red-50 c-red-700 p-10 lh-0 badge-pill");
		}

	}
	function validateNif() {
		
		var messageNifConfirm = /*[[#{form.user.nif.pattern}]]*/'default';
		
		var messageNif = $('#nif').val();
		
		const letraDNI = 'TRWAGMYFPDXBNJZSQVHLCKET'; // Letras asociadas a cada número de DNI
	    // Primero, verificamos que el formato básico sea correcto: 8 dígitos seguidos de una letra
	    const regex = /^[0-9]{8}[A-Z]$/;

	    if (regex.test(messageNif)) {
	        // Extraemos el número (los primeros 8 dígitos) y la letra del DNI
	        const numero = messageNif.substr(0, 8);
	        const letra = messageNif.charAt(8);

	        // Calculamos la letra correcta que debería seguir a los dígitos proporcionados
	        const letraCorrecta = letraDNI.charAt(parseInt(numero) % 23);

	        // Comprobamos si la letra proporcionada coincide con la letra calculada
	        if (letra === letraCorrecta) {
	        	$("#nif_span").text('');
				$("#nif_span").removeClass(
						"badge bgc-red-50 c-red-700 p-10 lh-0 badge-pill");
	          // DNI válido
	        } else {
	        	$("#nif_span").text(messageNifConfirm);
				$("#nif_span").addClass(
						"badge bgc-red-50 c-red-700 p-10 lh-0 badge-pill");
	           // La letra no coincide
	        }
	    } else {
	    	$("#nif_span").text(messageNifConfirm);
			$("#nif_span").addClass(
					"badge bgc-red-50 c-red-700 p-10 lh-0 badge-pill");
	        // Formato no válido
	    }
	}
</script>