<div class="modal fade" tabindex="-1" role="dialog"
	id="modalTryConnExAccess" data-backdrop="static" data-keyboard="false"
	onload="tryConn()">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title" th:text="#{table.externalAccess.title}"></h4>
				<button type="button" class="close" id="idButtonClosedX"
					onclick="closeModal('modalTryConnExAccess')" aria-label="Cerrar">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<table id="externalAccessTableModal"
					class="table table-striped table-bordered" cellspacing="0"
					width="100%">
					<thead>
						<tr>
							<!-- Columna oculta para el identificador de aplicaciÃ³n -->
							<th></th>
							<th th:text="#{table.externalAccess.url}"></th>
							<th th:text="#{table.externalAccess.stateConn}"></th>
						</tr>
					</thead>
				</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" id="idButtonClosed"
					onclick="closeModal('modalTryConnExAccess')"
					th:text="#{form.user.btn.close}"></button>
			</div>
		</div>
	</div>
</div>
<script th:inline="javascript" type="text/javascript">
var tblModal;
var btnGenerateReport =  /*[[#{table.externalAccess.report}]]*/;
var btnTryConn = /*[[#{table.externalAccess.tryConn}]]*/;
var btnDelApp  = /*[[#{table.app.btn.del}]]*/;
var getExternalAccessInicial =/*[[@{/externalAccessDatatableInicial}]]*/;
var getExternalAccess =/*[[@{/externalAccessDatatable}]]*/;
var eaTemplate = /*[[@{/addexternalAccess}]]*/;
var actionTryConn = /*[[@{/tryConn}]]*/;
var messageSelectTableToTry = /*[[#{table.externalAccess.tryConnError}]]*/;
$(document).ready(function() {
	$('#idButtonClosedX').hide();
    $('#idButtonClosed').hide();
    createDatatable();
    $.when(tryConn()).then({function(){
    	$('#idButtonClosedX').show();
        $('#idButtonClosed').show();
    }});
});


function createDatatable(){
	tblModal = $('#externalAccessTableModal').DataTable({
		data: dataSet,
		dom: 'frtip',
		select:false,
		responsive: true, 
		altEditor: true,
	    autoWidth: false, // This parameter must be set to false
		"iTotalRecords": "totalElements",
		"iTotalDisplayRecords": "numberOfElements",
		"processing": false,
		//"serverSide": true,
		/* "ajax":{
			"url":getExternalAccessInicial, 
			"dataSrc": "data",
			"data": function (data){
				debugger;
				//datos a pasar al modal
				data.formId = "externalAccessform";
				data.addTemplate = eaTemplate;
			}
		}, */
		"language": {
			"url":"js/datatables/i18n/spanish.json",
			select: {
				 rows: {
		                _: "%d filas seleccionadas",
		                1: "1 fila seleccionada"
		            }
			}
		},
		"columns":[
			 {"data": "idUrl","visible":false},
			 {"data": "url","width":"35%", "class":"breakWord"},
			 {"data": "stateConn", "width":"15%","render": function(data, type, row){
				 if (data == false) {
						return "<i class='ti-close' style='color: #e62d2d;font-weight: bold;'></i>";
	     		} else if (data == true){
						return "<i class='ti-check' style='color: #3da03b;font-weight: bold;'></i>";
					} else {
						return "<i class='ti-close' style='color: #e62d2d;font-weight: bold;'></i>";
					}
			 }} 
		]
	})
}
function tryConn() {
	debugger;

	var valores = [];
    var table = $("#externalAccessTable").DataTable();
    var data = table.rows().nodes();
    data.each(function (value, index) {
        var valor = value.cells[4].children[0].value;
        var check = value.cells[4].children[0].checked;
        if (check)
        {
       	 valores.push(valor);
        }            
    }); 
	
	var rows = valores;
	for (i = 0; i < rows.length; i++){
		var id= rows[i];
		$.ajax({
				url : actionTryConn,
				data: {'id':id},
				type : 'POST',
				 success: function(data){
	 	        	debugger;
	 	        	tblModal.row.add(data).draw();
	 	        },
	 	        error:function(data){
	 	        	// Se oculta la capa 'cargando...'
	 	        	hide();
				},
				complete:function(data){
					$('#idButtonClosedX').show();
			        $('#idButtonClosed').show();
				}
			});
	}
}
	



 
</script>